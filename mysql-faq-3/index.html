<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title class="pjax-title">MySQL 常见问题（三） - xiaobinqt 博客 - 技术改变生活</title><meta name="Description" content="xiaobinqt,MySQL表锁和行锁,MySQL常见索引,脏读,幻读,不可重复读,死锁问题出现的原因,死锁该如何避免,覆盖索引,索引下推"><meta property="og:title" content="MySQL 常见问题（三）" />
<meta property="og:description" content="xiaobinqt,MySQL表锁和行锁,MySQL常见索引,脏读,幻读,不可重复读,死锁问题出现的原因,死锁该如何避免,覆盖索引,索引下推" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.xiaobinqt.cn/mysql-faq-3/" /><meta property="og:image" content="https://www.xiaobinqt.cn/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-16T09:57:22+08:00" />
<meta property="og:see_also" content="https://www.xiaobinqt.cn/mysql-faq-2/" /><meta property="og:see_also" content="https://www.xiaobinqt.cn/problems-in-work/" /><meta property="og:see_also" content="https://www.xiaobinqt.cn/mysql-simple-faq/" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.xiaobinqt.cn/logo.png"/>

<meta name="twitter:title" content="MySQL 常见问题（三）"/>
<meta name="twitter:description" content="xiaobinqt,MySQL表锁和行锁,MySQL常见索引,脏读,幻读,不可重复读,死锁问题出现的原因,死锁该如何避免,覆盖索引,索引下推"/>
<meta name="application-name" content="xiaobinqt">
<meta name="apple-mobile-web-app-title" content="xiaobinqt">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c">
<link rel="stylesheet" href="//at.alicdn.com/t/font_3267767_dz25dtwdgdc.css"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://www.xiaobinqt.cn/mysql-faq-3/" /><link rel="prev" href="https://www.xiaobinqt.cn/session-cookie-token-difference/" /><link rel="next" href="https://www.xiaobinqt.cn/highly-concurrent-architecture-evolution/" /><link rel="stylesheet" href="/lib/md5/md5.min.js"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="hFkClWMTOtPBuE0lQaXNiNb707E7P6O2CwexZoSm3VQ" /><meta name="msvalidate.01" content="A961D393878F86E04112E1198500FDBD" /><meta name="baidu-site-verification" content="code-cMh5ORsrP2" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "MySQL 常见问题（三）",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.xiaobinqt.cn\/mysql-faq-3\/"
        },"image": ["https:\/\/www.xiaobinqt.cn\/images\/home.png"],"genre": "posts","keywords": "mysql","wordcount":  4034 ,
        "url": "https:\/\/www.xiaobinqt.cn\/mysql-faq-3\/","datePublished": "2022-07-11T00:00:00+00:00","dateModified": "2022-12-16T09:57:22+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/www.xiaobinqt.cn\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "xiaobinqt"
            },"description": "xiaobinqt,MySQL表锁和行锁,MySQL常见索引,脏读,幻读,不可重复读,死锁问题出现的原因,死锁该如何避免,覆盖索引,索引下推"
    }
    </script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');}
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="xiaobinqt 博客 - 技术改变生活"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>萧十一郎</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/series/"> 系列 </a><a class="menu-item" href="/memo/"> 收藏夹 </a><a class="menu-item" href="/links/"> 友链 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/xiaobinqt" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="xiaobinqt 博客 - 技术改变生活"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>萧十一郎</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" onclick="return false;" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/series/" title="">系列</a><a class="menu-item" href="/memo/" title="">收藏夹</a><a class="menu-item" href="/links/" title="">友链</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/xiaobinqt" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#innodbmyisam的区别">InnoDB、MyISAM的区别</a></li>
    <li><a href="#行锁和表锁的区别">行锁和表锁的区别</a></li>
    <li><a href="#共享锁和排他锁的区别">共享锁和排他锁的区别</a></li>
    <li><a href="#表锁行锁有哪些">表锁、行锁有哪些</a></li>
    <li><a href="#记录锁间隙锁临键锁这三种行锁有什么区别">记录锁、间隙锁、临键锁这三种行锁有什么区别</a></li>
    <li><a href="#隐式锁或手动加锁后什么时候释放锁">隐式锁或手动加锁后，什么时候释放锁</a></li>
    <li><a href="#mysql57的共享排他锁是什么">MySQL5.7的共享排他锁是什么</a></li>
    <li><a href="#死锁发生的原因该如何避免">死锁发生的原因，该如何避免</a></li>
    <li><a href="#有哪些常见索引">有哪些常见索引</a></li>
    <li><a href="#什么是索引覆盖和索引下推">什么是索引覆盖和索引下推</a></li>
    <li><a href="#什么是脏读幻读不可重复读">什么是脏读、幻读、不可重复读</a></li>
    <li><a href="#什么是脏写">什么是脏写</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle", "normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">MySQL 常见问题（三）</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><i class="author fas fa-user-circle fa-fw"></i><a href="/" title="Author" rel=" author" class="author">xiaobinqt</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/mysql/"><i class="far fa-folder fa-fw"></i>mysql</a></span>&nbsp;<span class="post-category">和</span>&nbsp;<span class="post-series">系列 <a href="/series/interview/"><i class="far fa-list-alt fa-fw"></i>八股文</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-07-11">2022-07-11</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2022-12-16">2022-12-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4034 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 9 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#innodbmyisam的区别">InnoDB、MyISAM的区别</a></li>
    <li><a href="#行锁和表锁的区别">行锁和表锁的区别</a></li>
    <li><a href="#共享锁和排他锁的区别">共享锁和排他锁的区别</a></li>
    <li><a href="#表锁行锁有哪些">表锁、行锁有哪些</a></li>
    <li><a href="#记录锁间隙锁临键锁这三种行锁有什么区别">记录锁、间隙锁、临键锁这三种行锁有什么区别</a></li>
    <li><a href="#隐式锁或手动加锁后什么时候释放锁">隐式锁或手动加锁后，什么时候释放锁</a></li>
    <li><a href="#mysql57的共享排他锁是什么">MySQL5.7的共享排他锁是什么</a></li>
    <li><a href="#死锁发生的原因该如何避免">死锁发生的原因，该如何避免</a></li>
    <li><a href="#有哪些常见索引">有哪些常见索引</a></li>
    <li><a href="#什么是索引覆盖和索引下推">什么是索引覆盖和索引下推</a></li>
    <li><a href="#什么是脏读幻读不可重复读">什么是脏读、幻读、不可重复读</a></li>
    <li><a href="#什么是脏写">什么是脏写</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><!-- author： xiaobinqt -->
<!-- email： xiaobinqt@163.com -->
<!-- https://xiaobinqt.github.io -->
<!-- https://www.xiaobinqt.cn -->
<h2 id="innodbmyisam的区别" class="headerLink">
    <a href="#innodbmyisam%e7%9a%84%e5%8c%ba%e5%88%ab" class="header-mark"></a>InnoDB、MyISAM的区别</h2><ul>
<li>磁盘文件不同：</li>
</ul>
<p>MyISAM引擎的表会生成三个磁盘文件：</p>
<p><code>table_name.frm</code> 该文件中存储表的结构信息。<code>table_name.MYD</code> 该文件中存储表的行数据。<code>table_name.MYI</code> 该文件中存储表的索引数据。</p>
<p>而InnoDB引擎的表只会生成两个磁盘文件：</p>
<p><code>table_name.frm</code> 该文件中存储表的结构信息。<code>table_name.ibd</code> 该文件中存储表的行数据和索引数据。</p>
<ul>
<li>InnoDB 支持聚簇索引，而 MyISAM 只支持非聚簇索引，因为 MyISAM 索引数据和表数据是<strong>分开存储</strong>的。</li>
<li>InnoDB 基于 Undo-log 日志实现了事务机制，但 MyISAM 没有，所以 MyISAM 不支持事务。</li>
<li>InnoDB 基于 Redo-log 日志实现了故障恢复机制，但 MyISAM 则只能依靠 Bin-log，因此会有丢失数据的风险。</li>
<li>InnoDB 可以基于聚簇索引实现行锁，同时还兼容表锁，但 MyISAM 仅支持表锁。</li>
<li>InnoDB 因为支持行锁以及 MVCC 机制，所以并发场景下的性能会远超 MyISAM 引擎。</li>
<li>InnoDB 由于设计了 BufferPool 缓冲池，所以内存利用度会远超 MyISAM 引擎。</li>
</ul>
<h2 id="行锁和表锁的区别" class="headerLink">
    <a href="#%e8%a1%8c%e9%94%81%e5%92%8c%e8%a1%a8%e9%94%81%e7%9a%84%e5%8c%ba%e5%88%ab" class="header-mark"></a>行锁和表锁的区别</h2><p>主要是粒度不同，表锁是指对一整张表加锁，当加锁后，其他来访问该表的事务都会被阻塞，而行锁的粒度则小很多，是指针对于一条/多条数据加锁，并不会阻塞操作同一表的事务，而仅仅
<strong>只会阻塞操作相同行数据的事务</strong>。</p>
<h2 id="共享锁和排他锁的区别" class="headerLink">
    <a href="#%e5%85%b1%e4%ba%ab%e9%94%81%e5%92%8c%e6%8e%92%e4%bb%96%e9%94%81%e7%9a%84%e5%8c%ba%e5%88%ab" class="header-mark"></a>共享锁和排他锁的区别</h2><p>共享锁允许多个事务一起持有，而排他锁在同一时间内只能允许一个事务持有，也就是但凡出现排他锁的场景，其他事务都需要阻塞等待。</p>
<h2 id="表锁行锁有哪些" class="headerLink">
    <a href="#%e8%a1%a8%e9%94%81%e8%a1%8c%e9%94%81%e6%9c%89%e5%93%aa%e4%ba%9b" class="header-mark"></a>表锁、行锁有哪些</h2><p>表锁有元数据锁、意向锁、自增锁、全局锁这四种，行锁有记录锁、间隙锁、临键锁、插入意向锁这四类，行锁在 MySQL 中是 InnoDB 引擎独有的，并且 InnoDB 的行锁和表锁之间，是相互兼容的。</p>
<h2 id="记录锁间隙锁临键锁这三种行锁有什么区别" class="headerLink">
    <a href="#%e8%ae%b0%e5%bd%95%e9%94%81%e9%97%b4%e9%9a%99%e9%94%81%e4%b8%b4%e9%94%ae%e9%94%81%e8%bf%99%e4%b8%89%e7%a7%8d%e8%a1%8c%e9%94%81%e6%9c%89%e4%bb%80%e4%b9%88%e5%8c%ba%e5%88%ab" class="header-mark"></a>记录锁、间隙锁、临键锁这三种行锁有什么区别</h2><p>记录锁是指对一条数据上锁、当我们针对主键或者唯一索引加锁的时候， MySQL 默认会对查询的这一行数据加行锁，避免其他事务对这一行数据进行修改。</p>
<p>间隙锁，就是锁定一个索引区间。在普通索引或者唯一索引列上，由于索引是基于 B+ 树的结构存储，所以默认会存在一个索引区间。而间隙锁，就是某个事务对索引列加锁的时候，默认锁定对应索引的
<strong>左右开区间</strong>范围。在基于索引列的范围查询，无论是否是唯一索引，都会自动触发间隙锁。比如基于<code>between</code>的范围查询，就会产生一个左右开区间的间隙锁。</p>
<p>临键锁，它相当于行锁+间隙锁的组合，也就是它的锁定范围既包含了索引记录，也包含了索引区间，它会锁定一个
<strong>左开右闭区间</strong>的数据范围。比如我们使用非唯一索引列进行查询的时候，默认会加一个临键锁，锁定一个左开右闭区间的范围。</p>
<p>总的来说，记录锁、临键锁、间隙锁只是表示锁定数据的范围，最终目的是<strong>为了解决幻读</strong>
的问题。而临键锁相当于行锁+间隙锁，因此当我们使用非唯一索引进行精准匹配的时候，会默认加临键锁，因为它需要锁定匹配的这一行数据，还需要锁定这一行数据对应的左开右闭区间。因此在实际应用中，尽可能使用唯一索引或者主键索引进行查询，避免大面积的锁定造成性能影响。</p>
<h2 id="隐式锁或手动加锁后什么时候释放锁" class="headerLink">
    <a href="#%e9%9a%90%e5%bc%8f%e9%94%81%e6%88%96%e6%89%8b%e5%8a%a8%e5%8a%a0%e9%94%81%e5%90%8e%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e9%87%8a%e6%94%be%e9%94%81" class="header-mark"></a>隐式锁或手动加锁后，什么时候释放锁</h2><p>几乎所有释放锁的工作都是 MySQL 自动完成的，但不同事务隔离级别中，释放锁的时机也不同，如果目前是读未提交级别，MySQL 执行完一条语句后就会立马释放锁。如果是其他级别中，基本上都需要等待持有锁的事务结束（commit/rollback）后才会释放。</p>
<h2 id="mysql57的共享排他锁是什么" class="headerLink">
    <a href="#mysql57%e7%9a%84%e5%85%b1%e4%ba%ab%e6%8e%92%e4%bb%96%e9%94%81%e6%98%af%e4%bb%80%e4%b9%88" class="header-mark"></a>MySQL5.7的共享排他锁是什么</h2><p>因为索引树的结构会发生变更，比如一个无序数据插入时，就会导致树节点的分裂，这时需要挪动树中的一些节点位置，为了防止其他事务再次破坏树结构，或从索引树中读到不对的数据，所以会对整棵树上锁，这个问题被称为<code>SMO</code>问题，共享排他锁主要就是用来解决<code>SMO</code>问题。</p>
<h2 id="死锁发生的原因该如何避免" class="headerLink">
    <a href="#%e6%ad%bb%e9%94%81%e5%8f%91%e7%94%9f%e7%9a%84%e5%8e%9f%e5%9b%a0%e8%af%a5%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8d" class="header-mark"></a>死锁发生的原因，该如何避免</h2><p>死锁，简单来说就是两个或者两个以上的线程在执行的过程中，争夺同一个共享资源造成的相互等待的现象。</p>
<p>如果没有外部干预，线程会一直阻塞无法往下执行，这些一直处于相互等待资源的线程就称为死锁线程。</p>
<p>导致死锁的条件有四个，也就是这四个条件<strong>同时满足</strong>就会产生死锁👇</p>
<ul>
<li>互斥条件，共享资源 X 和 Y 只能被一个线程占用</li>
<li>请求和保持条件，线程 T1 已经取得共享资源 X，在等待共享资源 Y 的时候，不释放共享资源 X</li>
<li>不可抢占条件，其他线程不能强行抢占线程 T1 占有的资源</li>
<li>循环等待条件，线程 T1 等待线程 T2 占有的资源，线程 T2 等待线程 T1 占有的资源，就是循环等待</li>
</ul>
<p>导致死锁之后，只能通过人工干预来解决，比如重启服务，或者杀掉某个线程。所以，只能在写代码的时候，去规避可能出现的死锁问题。</p>
<p>按照死锁发生的四个条件，<strong>只需要破坏其中的任何一个</strong>，就可以解决，但是，互斥条件是没办法破坏的，因为这是互斥锁的基本约束，其他三方条件都有办法来破坏：</p>
<ul>
<li>对于“请求和保持”这个条件，可以一次性申请所有的资源，这样就不存在等待了。</li>
<li>对于“不可抢占”这个条件，占用部分资源的线程进一步申请其他资源时，如果申请不到，可以主动释放它占有的资源，这样不可抢占这个条件就破坏掉了。</li>
<li>对于“循环等待”这个条件，可以靠按序申请资源来预防。所谓按序申请，是指资源是有线性顺序的，申请的时候可以先申请资源序号小的，再申请资源序号大的，这样线性化后自然就不存在循环了。</li>
</ul>
<h2 id="有哪些常见索引" class="headerLink">
    <a href="#%e6%9c%89%e5%93%aa%e4%ba%9b%e5%b8%b8%e8%a7%81%e7%b4%a2%e5%bc%95" class="header-mark"></a>有哪些常见索引</h2><p><strong>聚簇索引</strong>，在聚簇索引中，索引数据和表数据在磁盘中的位置是一起的。聚簇索引存的是主键和当前行的数据，一张表中只能存在一个聚簇索引，一般都会选用主键作为聚簇索引。一般聚簇索引要求索引必须是
<strong>非空唯一</strong>索引才行。</p>
<p><strong>唯一索引</strong>，索引中的索引节点值不允许重复，一般配合唯一约束使用。</p>
<p><strong>主键索引</strong>，是一种特殊的唯一索引，和普通唯一索引的区别在于<strong>不允许有空值</strong>。</p>
<p><strong>普通索引</strong>，通过<code>KEY</code>、<code>INDEX</code>关键字创建的索引就是这个类型，没什么限制，就是单纯的可以让查询快一点。</p>
<p><strong>全文索引</strong>
在 5.7 版本之前，只有 MyISAM 引擎支持。全文索引只能创建在<code>CHAR</code>、<code>VARCHAR</code>、<code>TEXT</code>等这些文本类型字段上，而且使用全文索引查询时，条件字符数量必须
<strong>大于</strong> 3 才生效。如果想要创建出的全文索引支持中文，需要在最后指定解析器<code>with parser ngram</code>。</p>
<h2 id="什么是索引覆盖和索引下推" class="headerLink">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e7%b4%a2%e5%bc%95%e8%a6%86%e7%9b%96%e5%92%8c%e7%b4%a2%e5%bc%95%e4%b8%8b%e6%8e%a8" class="header-mark"></a>什么是索引覆盖和索引下推</h2><p><strong>覆盖索引</strong></p>
<p>比如有个联合索引为<code>user_name、user_sex、password</code>，那么 SQL:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">user_name</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">user_sex</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">zz_users</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">`</span><span class="n">password</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;1234&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">user_sex</span><span class="o">`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&#34;男&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>虽然不符合联合索引的最左前缀匹配原则的，但是也可以用到索引，这就是索引覆盖。也就是：查询的列，在使用的索引中已经包含，被所使用的索引覆盖，这种情况称之为索引覆盖。</p>
<p><strong>索引下推</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    [&#34;熊猫&#34;,&#34;女&#34;,&#34;6666&#34;] : 1,
</span></span><span class="line"><span class="cl">    [&#34;竹子&#34;,&#34;男&#34;,&#34;1234&#34;] : 2,
</span></span><span class="line"><span class="cl">    [&#34;子竹&#34;,&#34;男&#34;,&#34;4321&#34;] : 3,
</span></span><span class="line"><span class="cl">    [&#34;1111&#34;,&#34;男&#34;,&#34;4321&#34;] : 4,
</span></span><span class="line"><span class="cl">    [&#34;竹竹&#34;,&#34;女&#34;,&#34;8888&#34;] : 5
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>比如 zz_users 表中有数据☝️，索引<code>user_name、user_sex、password</code>，查询 SQL：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">zz_users</span><span class="o">`</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">`</span><span class="n">user_name</span><span class="o">`</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s2">&#34;竹%&#34;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">user_sex</span><span class="o">`=</span><span class="s2">&#34;男&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>由于使用了模糊查询，但<code>%</code>在结尾，因此可以使用<code>竹</code>这个字作为条件在联合索引中查询，整个查询过程如下：</p>
<ul>
<li>① 利用联合索引中的<code>user_name</code>字段找出「竹子、竹竹」两个索引节点。</li>
<li>② 返回索引节点存储的值「2、5」给<code>Server</code>层，然后去逐一做回表扫描。</li>
<li>③ 在<code>Server</code>层中根据<code>user_sex=&quot;男&quot;</code>这个条件逐条判断，最终筛选到「竹子」这条数据。</li>
</ul>
<p>那么为什么<code>user_sex=&quot;男&quot;</code>这个条件不在联合索引中处理呢？因为前面是模糊查询，所以拼接起来是这样的<code>竹X男</code>，由于这个<code>X</code>是未知的，因此无法根据最左前缀原则去匹配数据，最终这里只能使用联合索引中<code>user_name</code>字段的一部分，后续的<code>user_sex=&quot;男&quot;</code>还需要回到<code>Server</code>层处理。</p>
<p>所谓的索引下推，就是将<code>Server</code>层筛选数据的工作，下推到引擎层处理。</p>
<p>MySQL5.6 后加入索引下推机制后，其执行过程就是下面的顺序：</p>
<ul>
<li>① 利用联合索引中的<code>user_name</code>字段找出「竹子、竹竹」两个索引节点。</li>
<li>② 根据<code>user_sex=&quot;男&quot;</code>这个条件在索引节点中逐个判断，从而得到「竹子」这个节点。</li>
<li>③ 最终将「竹子」这个节点对应的「2」返回给<code>Server</code>层，然后聚簇索引中回表拿数据。</li>
</ul>
<p>相较于没有索引下推之前，原本需要做「2、5」两次回表查询，但在拥有索引下推之后，仅需做「2」一次回表查询。</p>
<h2 id="什么是脏读幻读不可重复读" class="headerLink">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e8%84%8f%e8%af%bb%e5%b9%bb%e8%af%bb%e4%b8%8d%e5%8f%af%e9%87%8d%e5%a4%8d%e8%af%bb" class="header-mark"></a>什么是脏读、幻读、不可重复读</h2><p><strong>脏读</strong>：指一个事务读到了其他事务还未提交的数据，也就是当前事务读到的数据，由于还未提交，因此有可能会回滚。</p>
<p><strong>幻读</strong>：另外一个事务在第一个事务要处理的目标数据范围之内<strong>新增</strong>了数据，然后先于第一个事务提交造成的问题。</p>
<p>幻读是对自己来说的，比如，事务 A 在对表中多行数据进行修改，将性别「男、女」改为「0、1」，此时事务 B 又插入了一条性别为男的数据，当事务 A 提交后，再次查询表时，会发现表中依旧存在一条性别为男的数据。</p>
<p><strong>不可重复读</strong>：指在一个事务中，多次读取同一数据，先后读取到的数据不一致。</p>
<p>事务 A 执行下单业务时，因为添加物流信息的时候出错了，导致整个事务回滚，事务回滚完成后，事务 A 就结束了。但事务 B 却并未结束，在事务 B 中，在事务 A 执行时读取了一次剩余库存，然后在事务 A 回滚后又读取了一次剩余库存，仔细想想：B 事务第一次读到的剩余库存是扣减之后的，第二次读到的剩余库存则是扣减之前的（因为 A 事务回滚又加回去了），导致两次读取的数据不一致，这就是不可重复读。</p>
<h2 id="什么是脏写" class="headerLink">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e8%84%8f%e5%86%99" class="header-mark"></a>什么是脏写</h2><p>多个事务一起操作同一条数据，例如两个事务同时向表中添加一条<code>ID=88</code>的数据，此时就会造成数据覆盖，或者主键冲突的问题，这个问题也被称之为更新丢失问题。</p>
<h2 id="参考" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83" class="header-mark"></a>参考</h2><ul>
<li><a href="https://juejin.cn/post/7149074488649318431" target="_blank" rel="noopener noreferrer">建立索引的正确姿势与使用索引的最佳指南！</a></li>
<li><a href="https://juejin.cn/post/7152765784299667487" target="_blank" rel="noopener noreferrer">ACID原则、事务隔离级别及事务机制原理剖析</a></li>
<li><a href="https://juejin.cn/post/7156111610589741063" target="_blank" rel="noopener noreferrer">全解MySQL之死锁问题分析、事务隔离与锁机制的底层原理剖析</a></li>
</ul>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-12-16&nbsp;<a class="git-hash" href="https://github.com/xiaobinqt/xiaobinqt.github.io/commit/678136d8d169dd4e9654bfaf19b7b7dd604bd415" target="_blank" title="commit by weibin(xiaobinqt@163.com) 678136d8d169dd4e9654bfaf19b7b7dd604bd415: update series" rel="noopener noreferrer">
                                    <i class="fas fa-hashtag fa-fw"></i>678136d8</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/mysql-faq-3/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span></div>
            <div class="post-info-share">
                <span><a href="#" onclick="return false;" title="分享到 Twitter" data-sharer="twitter" data-url="https://www.xiaobinqt.cn/mysql-faq-3/" data-title="MySQL 常见问题（三）" data-hashtags="mysql"><i class="fab fa-twitter fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 Facebook" data-sharer="facebook" data-url="https://www.xiaobinqt.cn/mysql-faq-3/" data-hashtag="mysql"><i class="fab fa-facebook-square fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://www.xiaobinqt.cn/mysql-faq-3/" data-title="MySQL 常见问题（三）"><i class="fab fa-hacker-news fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 Line" data-sharer="line" data-url="https://www.xiaobinqt.cn/mysql-faq-3/" data-title="MySQL 常见问题（三）"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="#" onclick="return false;" title="分享到 微博" data-sharer="weibo" data-url="https://www.xiaobinqt.cn/mysql-faq-3/" data-title="MySQL 常见问题（三）"><i class="fab fa-weibo fa-fw"></i></a><a href="#" onclick="return false;" title="分享到 百度" data-sharer="baidu" data-url="https://www.xiaobinqt.cn/mysql-faq-3/" data-title="MySQL 常见问题（三）"><i data-svg-src="/lib/simple-icons/icons/baidu.min.svg"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/mysql/">mysql</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/session-cookie-token-difference/" class="prev" rel="prev" title="session cookie token 的区别"><i class="fas fa-angle-left fa-fw"></i>session cookie token 的区别</a>
            <a href="/highly-concurrent-architecture-evolution/" class="next" rel="next" title="高并发分布式架构演进">高并发分布式架构演进<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2018 - 2022</span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/algoliasearch/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/topbar/topbar.min.js"></script><script type="text/javascript" src="/lib/pjax/pjax.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>

<div class="pjax-assets"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{"gitalk":{"admin":["xiaobinqt"],"clientID":"47b15de6c2d8a0f8d707","clientSecret":"c70556c8b3a3b38ea7c72e539ff3b37d5bc1b4f3","id":"915c26a8dfa2be47701daf22e44bb0f1","owner":"xiaobinqt","repo":"xiaobinqt.github.io","title":"MySQL 常见问题（三）"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"algoliaAppID":"CPNWIDNX0Y","algoliaIndex":"xiaobinqt.io","algoliaSearchKey":"80b84de0ebc766371dd27cd3e651c41e","highlightTag":"em","maxResultLength":20,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"sharerjs":true};</script><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/js/gitalk.min.js" defer></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"></div>
</body>

</html>