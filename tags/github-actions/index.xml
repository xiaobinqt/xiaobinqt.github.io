<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Github-Actions - 标签 - xiaobinqt 博客 - 技术改变生活</title>
        <link>https://www.xiaobinqt.cn/tags/github-actions/</link>
        <description>Github-Actions - 标签 - xiaobinqt 博客 - 技术改变生活</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>xiaobinqt@163.com (xiaobinqt)</managingEditor>
            <webMaster>xiaobinqt@163.com (xiaobinqt)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Sat, 02 Apr 2022 00:00:00 &#43;0000</lastBuildDate><atom:link href="https://www.xiaobinqt.cn/tags/github-actions/" rel="self" type="application/rss+xml" /><item>
    <title>Github Actions replace env vars in file</title>
    <link>https://www.xiaobinqt.cn/github-actions-replace-env-vars-in-file/</link>
    <pubDate>Sat, 02 Apr 2022 00:00:00 &#43;0000</pubDate><author>
        <name>xiaobinqt</name>
    </author><guid>https://www.xiaobinqt.cn/github-actions-replace-env-vars-in-file/</guid>
    <description><![CDATA[<p>Github Actions 是个好东西&#x1f600;，最近在使用的时候有个需求是，我项目不想把设置成私有的，但是有些配置又比较私密，比如 github 的 Personal access token，这种配置就不能暴露出来。
呃，这种需求前辈们估计也遇到过，<a href="https://github.com/marketplace?type=actions" target="_blank" rel="noopener noreferrer">github actions marketplace</a>
是个好地方，我去里面搜了搜，果然有很多轮子，但是不知道能不能满足需求。</p>
<p><figure><a class="lightgallery" href="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220402/cf7d693259714fda8798eb7b9eaaff1c.png?imageView2/0/q/75%7cwatermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" title="marketplace" data-thumbnail="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220402/cf7d693259714fda8798eb7b9eaaff1c.png?imageView2/0/q/75|watermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" data-sub-html="<h2>marketplace</h2><p>marketplace</p>">
        
    </a><figcaption class="image-caption">marketplace</figcaption>
    </figure></p>
<h2 id="replace-env-vars-in-file" class="headerLink">
    <a href="#replace-env-vars-in-file" class="header-mark"></a>replace-env-vars-in-file</h2><p><a href="https://github.com/marketplace/actions/replace-env-vars-in-file" target="_blank" rel="noopener noreferrer">Replace env vars in file</a> 是我选中的一个轮子。</p>
<p><figure><a class="lightgallery" href="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220402/436e6e8bd1b441da9f8861f5cb096ac0.png?imageView2/0/q/75%7cwatermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" title="Replace env vars in file" data-thumbnail="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220402/436e6e8bd1b441da9f8861f5cb096ac0.png?imageView2/0/q/75|watermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" data-sub-html="<h2>Replace env vars in file</h2><p>Replace env vars in file</p>">
        
    </a><figcaption class="image-caption">Replace env vars in file</figcaption>
    </figure></p>
<p><a href="https://github.com/marketplace/actions/replace-env-vars-in-file" target="_blank" rel="noopener noreferrer">Replace env vars in file</a> 的文档就一句话，
<code>Replaces __TOKENS__ with environment variables in file.</code>
我刚开始还不太理解。</p>
<p>好吧，其实是<strong>所有的环境变量都必须以<code>__</code>开头，然后以<code>__</code>结尾，这样才能被替换</strong>。</p>
<p>我在项目中是这样使用的：</p>
<p><figure><a class="lightgallery" href="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220421/78223a9a71cb4b39bf09daf1f36d3167.png?imageView2/0/q/75%7cwatermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" title="配置文件" data-thumbnail="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220421/78223a9a71cb4b39bf09daf1f36d3167.png?imageView2/0/q/75|watermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" data-sub-html="<h2>配置文件</h2><p>配置文件</p>">
        
    </a><figcaption class="image-caption">配置文件</figcaption>
    </figure></p>
<p><figure><a class="lightgallery" href="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220421/4d886ce9639043da9bf7794908404277.png?imageView2/0/q/75%7cwatermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" title="action 中替换" data-thumbnail="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220421/4d886ce9639043da9bf7794908404277.png?imageView2/0/q/75|watermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" data-sub-html="<h2>action 中替换</h2><p>action 中替换</p>">
        
    </a><figcaption class="image-caption">action 中替换</figcaption>
    </figure></p>
<p>具体可以参看 <a href="https://github.com/xiaobinqt/xiaobinqt.github.io/blob/23f0767e6b77f46c70edbf50e6822e5eebd85622/config.toml#L495" target="_blank" rel="noopener noreferrer">config.toml 配置文件</a>
，<a href="https://github.com/xiaobinqt/xiaobinqt.github.io/blob/23f0767e6b77f46c70edbf50e6822e5eebd85622/.github/workflows/ci.yml#L18" target="_blank" rel="noopener noreferrer">workflows
工作流</a></p>
<h2 id="simple-template-renderer" class="headerLink">
    <a href="#simple-template-renderer" class="header-mark"></a>simple-template-renderer</h2><p><a href="https://github.com/marketplace/actions/simple-template-renderer" target="_blank" rel="noopener noreferrer">simple-template-renderer</a>
相比 <a href="https://github.com/marketplace/actions/replace-env-vars-in-file" target="_blank" rel="noopener noreferrer">Replace env vars in file</a>
有个明显的优势，simple-template-renderer 支持 html 格式，replace-env-vars-in-file 不支持&#x1f622;。</p>
<p>比如源文件中有</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">icp = &#34;${ICP}&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这个变量，需要把 <code>${ICP}</code> 替换成一个 html 的变量：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ICP: <span class="s2">&#34;&lt;a href=https://beian.miit.gov.cn/ target=_blank&gt;京ICP备16062974号-1&lt;/a&gt;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220513/296318e8d2664cc3bb920f1c9406ed4a.png?imageView2/0/q/75%7cwatermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" title="simple-template-renderer" data-thumbnail="https://cdn.xiaobinqt.cn/xiaobinqt.io/20220513/296318e8d2664cc3bb920f1c9406ed4a.png?imageView2/0/q/75|watermark/2/text/eGlhb2JpbnF0/font/dmlqYXlh/fontsize/1000/fill/IzVDNUI1Qg==/dissolve/52/gravity/SouthEast/dx/15/dy/15" data-sub-html="<h2>simple-template-renderer</h2><p>simple-template-renderer</p>">
        
    </a><figcaption class="image-caption">simple-template-renderer</figcaption>
    </figure></p>
]]></description>
</item></channel>
</rss>
