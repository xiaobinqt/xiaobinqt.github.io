<!DOCTYPE html>
<html lang="zh" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="6.3 ftp # 6.3.1 协议介绍 # FTP（File Transfer Protocol）是一种用于在计算机网络上进行文件传输的标准协议。它使用客户端-服务器模型，在客户端和服务器之间进行文件传输和交互。
FTP 协议定义了一套命令和响应规范，用于控制和管理文件传输过程。它支持用户身份验证、目录浏览、文件上传和下载等操作。
在 FTP 中，存在两种模式来建立数据连接：主动（Active）模式和被动（Passive）模式。
主动模式（Active Mode）：
在主动模式下，FTP 客户端使用随机生成的端口（通常大于1024）向服务器的默认 FTP 数据端口（端口20）发起连接。 FTP 客户端发送一个 PORT 命令，其中包含客户端的 IP 地址和数据端口号。 FTP 服务器使用它的默认控制端口（端口21）向 FTP 客户端的指定数据端口发起连接，以建立数据连接，并进行文件传输。 主动模式需要 FTP 服务器能够主动连接 FTP 客户端，因此 FTP 服务器通常需要允许外部访问，并配置防火墙和 NAT 设备以允许数据连接。 被动模式（Passive Mode）：
在被动模式下，FTP 客户端发送 PASV 命令给 FTP 服务器，请求进入被动模式。 FTP 服务器在一个固定的范围内选择一个可用的端口（通常大于1024），并将其作为数据端口。 FTP 服务器将自己的 IP 地址和数据端口作为响应发送给FTP客户端。 FTP 客户端使用这个 IP 地址和数据端口发起连接，以建立数据连接，并进行文件传输。 被动模式适用于FTP客户端位于防火墙或 NAT 后面的情况，因为它不需要FTP服务器主动连接FTP客户端。 总结来说，主动模式和被动模式是 FTP 用于建立数据连接的两种不同方式。主动模式要求 FTP 服务器主动连接 FTP 客户端，而被动模式则允许 FTP 客户端主动连接 FTP 服务器。在配置 FTP 服务器和网络环境时，需要根据具体情况选择适合的模式，并确保防火墙和 NAT 设备正确配置以允许数据连接的建立。">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="6.3 ftp" />
<meta property="og:description" content="6.3 ftp # 6.3.1 协议介绍 # FTP（File Transfer Protocol）是一种用于在计算机网络上进行文件传输的标准协议。它使用客户端-服务器模型，在客户端和服务器之间进行文件传输和交互。
FTP 协议定义了一套命令和响应规范，用于控制和管理文件传输过程。它支持用户身份验证、目录浏览、文件上传和下载等操作。
在 FTP 中，存在两种模式来建立数据连接：主动（Active）模式和被动（Passive）模式。
主动模式（Active Mode）：
在主动模式下，FTP 客户端使用随机生成的端口（通常大于1024）向服务器的默认 FTP 数据端口（端口20）发起连接。 FTP 客户端发送一个 PORT 命令，其中包含客户端的 IP 地址和数据端口号。 FTP 服务器使用它的默认控制端口（端口21）向 FTP 客户端的指定数据端口发起连接，以建立数据连接，并进行文件传输。 主动模式需要 FTP 服务器能够主动连接 FTP 客户端，因此 FTP 服务器通常需要允许外部访问，并配置防火墙和 NAT 设备以允许数据连接。 被动模式（Passive Mode）：
在被动模式下，FTP 客户端发送 PASV 命令给 FTP 服务器，请求进入被动模式。 FTP 服务器在一个固定的范围内选择一个可用的端口（通常大于1024），并将其作为数据端口。 FTP 服务器将自己的 IP 地址和数据端口作为响应发送给FTP客户端。 FTP 客户端使用这个 IP 地址和数据端口发起连接，以建立数据连接，并进行文件传输。 被动模式适用于FTP客户端位于防火墙或 NAT 后面的情况，因为它不需要FTP服务器主动连接FTP客户端。 总结来说，主动模式和被动模式是 FTP 用于建立数据连接的两种不同方式。主动模式要求 FTP 服务器主动连接 FTP 客户端，而被动模式则允许 FTP 客户端主动连接 FTP 服务器。在配置 FTP 服务器和网络环境时，需要根据具体情况选择适合的模式，并确保防火墙和 NAT 设备正确配置以允许数据连接的建立。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/linux/docs/part6-service-manage/6.3-ftp/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2023-07-10T15:56:32+08:00" />
<title>6.3 ftp | Linux 学习笔记</title>
<link rel="manifest" href="/linux/manifest.json">
<link rel="icon" href="/linux/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/linux/book.min.cad59a3be22b32d901c8b99a5bf0c00f01535383d8d0e86742e5449f598d17af.css" integrity="sha256-ytWaO&#43;IrMtkByLmaW/DADwFTU4PY0OhnQuVEn1mNF68=" crossorigin="anonymous">
  <script defer src="/linux/flexsearch.min.js"></script>
  <script defer src="/linux/zh.search.min.93a1751abd85f22df13a8d45318b078849f86406a52636e94842ff512341728f.js" integrity="sha256-k6F1Gr2F8i3xOo1FMYsHiEn4ZAalJjbpSEL/USNBco8=" crossorigin="anonymous"></script>

  <script defer src="/linux/sw.min.e3338ad661715b83bfd6397040a613605d8bb26c10798773e2176216e2123560.js" integrity="sha256-4zOK1mFxW4O/1jlwQKYTYF2LsmwQeYdz4hdiFuISNWA=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/linux/"><span>Linux 学习笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="搜索" aria-label="搜索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>




<ul>
    <li>
        <a href="javascript:void(0)" onclick="hrefIndex()" rel="noopener">主页</a>
    </li>
    <li>
        <a href="https://github.com/xiaobinqt" target="_blank" rel="noopener">GitHub</a>
    </li>
</ul>

<hr>

<script>
    function hrefIndex() {
        window.location = window.location.origin;
    }
</script>


  
<ul>
  
  <li>
    <a href=""  target="_blank" rel="noopener">
        
      </a>
  </li>
  
</ul>







  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>第一部分 基础知识</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.1-operating-system/" class="">1.1 操作系统</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.2-overview/" class="">1.2 总览</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.3-common-dir/" class="">1.3 常见目录</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.4-process-manage/" class="">1.4 进程管理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.5-deadlock/" class="">1.5 死锁</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.6-memory-manage/" class="">1.6 内存管理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.7-link/" class="">1.7 链接</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.7-device-manage/" class="">1.7 设备管理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part1-primary/1.8-instruction-arch/" class="">1.8 指令集</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>第二部分 系统操作</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.1-help/" class="">2.1 帮助命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.2-ls/" class="">2.2 ls 命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.3-shutdown/" class="">2.3 关机</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.4-cp/" class="">2.4 cp 命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.5-file-view/" class="">2.5 文件查看命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.6-backup-compression/" class="">2.6 压缩和打包</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.7-vim/" class="">2.7 vim</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.8-user-manage/" class="">2.8 用户管理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.9-switch-user/" class="">2.9 切换用户</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part2-sys-operate/2.10-file-dir/" class="">2.10 文件和文件夹</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>第三部分 系统管理</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part3-sys-manage/3.1-network/" class="">3.1 网络</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part3-sys-manage/3.2-net-trouble-removal/" class="">3.2 网络故障排除</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part3-sys-manage/3.3-net-manage/" class="">3.3 网络服务管理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part3-sys-manage/3.4-soft-install/" class="">3.4 软件安装</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part3-sys-manage/3.5-process/" class="">3.5 进程管理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part3-sys-manage/3.6-memory-disk/" class="">3.6 内存和磁盘管理</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>第四部分 Shell</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.1-introduction/" class="">4.1 Shell 简介</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.2-env-config-file/" class="">4.2 环境变量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.3-array/" class="">4.3 数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.4-escape-quot/" class="">4.4 转义和引用</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.5-operator/" class="">4.5 运算符</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.6-test-and-judge/" class="">4.6 测试和判断</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.7-process-control/" class="">4.7 流程控制</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.8-function/" class="">4.8 函数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part4-shell/4.9-script-cron/" class="">4.9 脚本和计划任务</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>第五部分 文本操作</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part5-text-operate/5.1-regular/" class="">5.1 正则表达式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part5-text-operate/5.2-sed/" class="">5.2 sed 命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part5-text-operate/5.3-awk/" class="">5.3 awk 命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part5-text-operate/5.4-cut-sort-uniq-tr/" class="">5.4 cut、sort、uniq、tr 命令</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>第六部分 服务管理</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.1-firewall/" class="">6.1 防火墙</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.2-ssh/" class="">6.2 ssh</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.3-ftp/" class="active">6.3 ftp</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.4-samba/" class="">6.4 samba</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.5-nfs/" class="">6.5 NFS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.6-nginx/" class="">6.6 nginx</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.7-dns/" class="">6.7 DNS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part6-service-manage/6.8-nas/" class="">6.8 NAS</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>第七部分 常见问题</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/linux/docs/part7-faq/7.1-cmd/" class="">7.1 命令相关</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/linux/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>6.3 ftp</strong>

  <label for="toc-control">
    
    <img src="/linux/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#63-ftp">6.3 ftp</a>
      <ul>
        <li><a href="#631-协议介绍">6.3.1 协议介绍</a></li>
        <li><a href="#632-vsftpd">6.3.2 vsftpd</a>
          <ul>
            <li><a href="#配置文件">配置文件</a></li>
          </ul>
        </li>
        <li><a href="#633-常用命令">6.3.3 常用命令</a></li>
        <li><a href="#634-虚拟用户验证">6.3.4 虚拟用户验证</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="63-ftp">
  6.3 ftp
  <a class="anchor" href="#63-ftp">#</a>
</h1>
<h2 id="631-协议介绍">
  6.3.1 协议介绍
  <a class="anchor" href="#631-%e5%8d%8f%e8%ae%ae%e4%bb%8b%e7%bb%8d">#</a>
</h2>
<p>FTP（File Transfer Protocol）是一种用于在计算机网络上进行文件传输的标准协议。它使用客户端-服务器模型，在客户端和服务器之间进行文件传输和交互。</p>
<p>FTP 协议定义了一套命令和响应规范，用于控制和管理文件传输过程。它支持用户身份验证、目录浏览、文件上传和下载等操作。</p>
<p>在 FTP 中，存在两种模式来建立数据连接：主动（Active）模式和被动（Passive）模式。</p>
<ol>
<li>
<p>主动模式（Active Mode）：</p>
<ul>
<li>在主动模式下，FTP 客户端使用随机生成的端口（通常大于1024）向服务器的默认 FTP 数据端口（端口20）发起连接。</li>
<li>FTP 客户端发送一个 PORT 命令，其中包含客户端的 IP 地址和数据端口号。</li>
<li>FTP 服务器使用它的默认控制端口（端口21）向 FTP 客户端的指定数据端口发起连接，以建立数据连接，并进行文件传输。</li>
<li>主动模式需要 FTP 服务器能够主动连接 FTP 客户端，因此 FTP 服务器通常需要允许外部访问，并配置防火墙和 NAT 设备以允许数据连接。</li>
</ul>
</li>
<li>
<p>被动模式（Passive Mode）：</p>
<ul>
<li>在被动模式下，FTP 客户端发送 PASV 命令给 FTP 服务器，请求进入被动模式。</li>
<li>FTP 服务器在一个固定的范围内选择一个可用的端口（通常大于1024），并将其作为数据端口。</li>
<li>FTP 服务器将自己的 IP 地址和数据端口作为响应发送给FTP客户端。</li>
<li>FTP 客户端使用这个 IP 地址和数据端口发起连接，以建立数据连接，并进行文件传输。</li>
<li>被动模式适用于FTP客户端位于防火墙或 NAT 后面的情况，因为它不需要FTP服务器主动连接FTP客户端。</li>
</ul>
</li>
</ol>
<p>总结来说，主动模式和被动模式是 FTP 用于建立数据连接的两种不同方式。主动模式要求 FTP 服务器主动连接 FTP 客户端，而被动模式则允许 FTP 客户端主动连接 FTP 服务器。在配置 FTP 服务器和网络环境时，需要根据具体情况选择适合的模式，并确保防火墙和 NAT 设备正确配置以允许数据连接的建立。</p>
<h2 id="632-vsftpd">
  6.3.2 vsftpd
  <a class="anchor" href="#632-vsftpd">#</a>
</h2>
<p>vsftpd（Very Secure FTP Daemon）是一个开源的FTP服务器软件，旨在提供一个安全、稳定和高性能的FTP服务器。它是Linux和UNIX系统中最常用的FTP服务器之一。</p>
<p>下面是 vsftpd 的一些主要特点：</p>
<ol>
<li>
<p>安全性：vsftpd 注重安全性，提供了多种安全特性和选项。它支持 SSL/TLS 加密传输，可以保护 FTP 连接的机密性。此外，它还支持用户访问限制、防止匿名访问和限制 FTP 命令等功能，以增强服务器的安全性。</p>
</li>
<li>
<p>高性能：vsftpd 被设计为高性能的 FTP 服务器，具有低的资源占用和高的吞吐量。它采用异步 I/O 和多线程处理技术，能够处理大量的并发FTP连接，同时提供快速的文件传输速度。</p>
</li>
<li>
<p>可定制性：vsftpd 具有丰富的配置选项，允许管理员根据需求进行定制。您可以根据需要配置用户访问权限、目录限制、上传/下载限制、日志记录等。</p>
</li>
<li>
<p>虚拟用户支持：vsftpd 支持虚拟用户，这些用户的认证信息可以存储在独立的数据库中，而不是使用系统用户。这提供了更灵活的用户管理和认证方式。</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 安装服务端和客户端</span>
</span></span><span style="display:flex;"><span>yum install vsftpd ftp -y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动</span>
</span></span><span style="display:flex;"><span>systemctl start vsftpd.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加防火墙，因为有主动和被动模式，可以使用 firewall-cmd 方式添加服务</span>
</span></span><span style="display:flex;"><span>firewall-cmd --add-service ftp
</span></span></code></pre></div><p>启动 ftp 服务后可以使用匿名账号登录，匿名账号用户民为 ftp，密码可以为空：</p>
<div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230709/c509e9a4a9b54aa88963530f8094d4d7.png" width=  /></div>
<p>建议将 selinux 改为 permissive</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>getsebool -a | grep ftpd
</span></span><span style="display:flex;"><span>setsebool -P &lt;sebool&gt; <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><h3 id="配置文件">
  配置文件
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/vsftpd/vsftpd.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 用户黑名单</span>
</span></span><span style="display:flex;"><span>/etc/vsftpd/ftpusers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 黑白名单</span>
</span></span><span style="display:flex;"><span>/etc/vsftpd/user_list
</span></span></code></pre></div><h2 id="633-常用命令">
  6.3.3 常用命令
  <a class="anchor" href="#633-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4">#</a>
</h2>
<p>以下是 vsftpd 中的一些常用命令：</p>
<ol>
<li><code>service vsftpd start</code>：启动 vsftpd 服务。</li>
<li><code>service vsftpd stop</code>：停止 vsftpd 服务。</li>
<li><code>service vsftpd restart</code>：重启 vsftpd 服务。</li>
<li><code>service vsftpd status</code>：检查 vsftpd 服务的状态。</li>
<li><code>service vsftpd reload</code>：重新加载 vsftpd 的配置文件，使更改生效。</li>
<li><code>chkconfig vsftpd on</code>：设置 vsftpd 在系统启动时自动启动。</li>
<li><code>chkconfig vsftpd off</code>：禁止 vsftpd 在系统启动时自动启动。</li>
<li><code>useradd -d /path/to/home -s /sbin/nologin username</code>：创建一个 FTP 用户，指定家目录和禁止登录 shell。</li>
<li><code>passwd username</code>：设置 FTP 用户的密码。</li>
<li><code>userdel username</code>：删除 FTP 用户。</li>
<li><code>chmod</code> 和 <code>chown</code>：用于更改文件和目录的权限和所有者，以控制用户对文件的访问。</li>
<li><code>ls</code>：列出当前目录中的文件和目录。</li>
<li><code>cd</code>：更改当前目录。</li>
<li><code>get</code>：从FTP服务器下载文件到本地计算机。</li>
<li><code>put</code>：将文件上传到FTP服务器。</li>
<li><code>mget</code>：批量下载多个文件。</li>
<li><code>mput</code>：批量上传多个文件。</li>
<li><code>delete</code>：从 FTP 服务器上删除文件。</li>
<li><code>mkdir</code>：在 FTP 服务器上创建目录。</li>
<li><code>rmdir</code>：删除 FTP 服务器上的目录。</li>
<li><code>quit</code> 或 <code>exit</code>：退出 FTP 会话。</li>
</ol>
<h2 id="634-虚拟用户验证">
  6.3.4 虚拟用户验证
  <a class="anchor" href="#634-%e8%99%9a%e6%8b%9f%e7%94%a8%e6%88%b7%e9%aa%8c%e8%af%81">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>guest_enable<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>guest_username<span style="color:#f92672">=</span>vuser
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 权限控制文件</span>
</span></span><span style="display:flex;"><span>user_config_dir<span style="color:#f92672">=</span>/etc/vsftpd/vuserconfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>allow_writeable_chroot<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pam_service_name<span style="color:#f92672">=</span>vsftpd.vuser
</span></span></code></pre></div><p>创建虚拟用户：</p>
<div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230710/0461692174c048bfb19697799d48a214.png" width=  /></div>
<p>设置让 ftp 识别验证 vuser.db。编写一个 /etc/pam.d/vsftpd.vuser 格式与 /etc/pam.d/vsftpd 相同，文件内容为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>auth sufficient /lib64/security/pam_userdb.so db<span style="color:#f92672">=</span>/etc/vsftpd/vuser
</span></span><span style="display:flex;"><span>account sufficient /lib64/security/pam_userdb.so db<span style="color:#f92672">=</span>/etc/vsftpd/vuser
</span></span></code></pre></div><p>修改主配置文件 /etc/vsftpd/vsftpd.conf ：</p>
<p>关闭 <code>pam_service_name=vsftpd</code> 配置，这样匿名和本地用户就不被支持了。</p>
<p>添加或打开以下配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>guest_enable<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>guest_username<span style="color:#f92672">=</span>vuser
</span></span><span style="display:flex;"><span>allow_writeable_chroot<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>pam_service_name<span style="color:#f92672">=</span>vsftpd.vuser
</span></span><span style="display:flex;"><span>user_config_dir<span style="color:#f92672">=</span>/etc/vsftpd/vusercofig
</span></span></code></pre></div><div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230710/0d5824e6fc4642fd9e7c7eab18847c5b.png" width=  /></div>
<blockquote class="book-hint warning">
  截图中的 allow_writeable_chroot 写错了。
</blockquote>

<p>/etc/vsftpd/vuserconfig 这个目录默认是没有的，需要手动创建，因为有 u1，u2，u3 三个虚拟用户，可以在 /etc/vsftpd/vuserconfig 目录下创建 3 个同名文件：</p>
<div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230710/80314198cc5840df9c23319015d2db9f.png" width=  /></div>
<p>每个文件配置的 ftp 的权限控制，常见配置如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>local_root<span style="color:#f92672">=</span>/data/ftp
</span></span><span style="display:flex;"><span>write_enable<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>anon_umask<span style="color:#f92672">=</span><span style="color:#ae81ff">022</span>
</span></span><span style="display:flex;"><span>anon_world_readable_only<span style="color:#f92672">=</span>NO
</span></span><span style="display:flex;"><span>anon_upload_enable<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>anon_mkdir_write_enable<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>anon_other_write_enable<span style="color:#f92672">=</span>YES
</span></span><span style="display:flex;"><span>download_enable<span style="color:#f92672">=</span>YES
</span></span></code></pre></div><p>配置完成后重启 ftp 服务：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>systemctl restart vsftpd.service
</span></span></code></pre></div><p>用另外一台机器可以测试，用虚拟用 u1 登录 ftp：</p>
<div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230710/de3d46dedef749d9b35e8c86b1ceaf8c.png" width=  /></div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/xiaobinqt/xiaobinqt.github.io/commit/839526aa7ea291eb299887a86df0691efaab6f0a" title='最后修改者 weibin | July 10, 2023' target="_blank" rel="noopener">
      <img src="/linux/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>July 10, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/xiaobinqt/xiaobinqt.github.io/tree/main/content/docs/part6-service-manage/6.3-ftp.md" target="_blank" rel="noopener">
      <img src="/linux/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>编辑本页</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#63-ftp">6.3 ftp</a>
      <ul>
        <li><a href="#631-协议介绍">6.3.1 协议介绍</a></li>
        <li><a href="#632-vsftpd">6.3.2 vsftpd</a>
          <ul>
            <li><a href="#配置文件">配置文件</a></li>
          </ul>
        </li>
        <li><a href="#633-常用命令">6.3.3 常用命令</a></li>
        <li><a href="#634-虚拟用户验证">6.3.4 虚拟用户验证</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












