<!DOCTYPE html>
<html lang="zh" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="2.13 PersistentVolume # Pod é‡Œçš„å®¹å™¨æ˜¯ç”±é•œåƒäº§ç”Ÿçš„ï¼Œè€Œé•œåƒæ–‡ä»¶æœ¬èº«æ˜¯åªè¯»çš„ï¼Œè¿›ç¨‹è¦è¯»å†™ç£ç›˜åªèƒ½ç”¨ä¸€ä¸ªä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ï¼Œä¸€æ—¦ Pod é”€æ¯ï¼Œä¸´æ—¶å­˜å‚¨ä¹Ÿå°±ä¼šç«‹å³å›æ”¶é‡Šæ”¾ï¼Œæ•°æ®ä¹Ÿå°±ä¸¢å¤±äº†ã€‚
Kubernetes çš„ Volume å¯¹æ•°æ®å­˜å‚¨å·²ç»ç»™å‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„æŠ½è±¡ï¼Œå®ƒåªæ˜¯å®šä¹‰äº†æœ‰è¿™ä¹ˆä¸€ä¸ª â€œå­˜å‚¨å·â€ï¼Œè€Œè¿™ä¸ª â€œå­˜å‚¨å·â€ æ˜¯ä»€ä¹ˆç±»å‹ã€æœ‰å¤šå¤§å®¹é‡ã€æ€ä¹ˆå­˜å‚¨ï¼Œå¯ä»¥è‡ªç”±å‘æŒ¥ã€‚Pod ä¸éœ€è¦å…³å¿ƒé‚£äº›ä¸“ä¸šã€å¤æ‚çš„ç»†èŠ‚ï¼Œåªè¦è®¾ç½®å¥½ volumeMountsï¼Œå°±å¯ä»¥æŠŠ Volume åŠ è½½è¿›å®¹å™¨é‡Œä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œç”± Volume çš„æ¦‚å¿µï¼Œå»¶ä¼¸å‡ºäº† PersistentVolume å¯¹è±¡ï¼Œå®ƒä¸“é—¨ç”¨æ¥è¡¨ç¤ºæŒä¹…å­˜å‚¨è®¾å¤‡ï¼Œä½†éšè—äº†å­˜å‚¨çš„åº•å±‚å®ç°ï¼Œä½¿ç”¨è€…åªéœ€è¦çŸ¥é“å®ƒèƒ½å®‰å…¨å¯é åœ°ä¿ç®¡æ•°æ®å°±å¯ä»¥äº†ï¼ˆç”±äº PersistentVolume è¿™ä¸ªè¯å¾ˆé•¿ï¼Œä¸€èˆ¬æŠŠå®ƒç®€ç§°ä¸º PVï¼‰ã€‚
ä½œä¸ºå­˜å‚¨çš„æŠ½è±¡ï¼ŒPV å®é™…ä¸Šå°±æ˜¯ä¸€äº›å­˜å‚¨è®¾å¤‡ã€æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ Cephã€GlusterFSã€NFSï¼Œç”šè‡³æ˜¯æœ¬åœ°ç£ç›˜ï¼Œç®¡ç†å®ƒä»¬å·²ç»è¶…å‡ºäº† Kubernetes çš„èƒ½åŠ›èŒƒå›´ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬ä¼šç”±ç³»ç»Ÿç®¡ç†å‘˜å•ç‹¬ç»´æŠ¤ï¼Œç„¶åå†åœ¨ Kubernetes é‡Œåˆ›å»ºå¯¹åº”çš„ PVã€‚PV å±äºé›†ç¾¤çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯å’Œ Node å¹³çº§çš„ä¸€ç§å¯¹è±¡ï¼ŒPod å¯¹å®ƒæ²¡æœ‰ç®¡ç†æƒï¼Œåªæœ‰ä½¿ç”¨æƒã€‚
2.13.1 PersistentVolumeClaim/StorageClass # ç”±äºä¸åŒå­˜å‚¨è®¾å¤‡çš„å·®å¼‚å®åœ¨æ˜¯å¤ªå¤§äº†ï¼šæœ‰çš„é€Ÿåº¦å¿«ï¼Œæœ‰çš„é€Ÿåº¦æ…¢ï¼›æœ‰çš„å¯ä»¥å…±äº«è¯»å†™ï¼Œæœ‰çš„åªèƒ½ç‹¬å è¯»å†™ï¼›æœ‰çš„å®¹é‡å°ï¼Œåªæœ‰å‡ ç™¾ MBï¼Œæœ‰çš„å®¹é‡å¤§åˆ° TBã€PB çº§åˆ«ç­‰ï¼Œè¿™ä¹ˆå¤šç§å­˜å‚¨è®¾å¤‡ï¼Œåªç”¨ä¸€ä¸ª PV å¯¹è±¡æ¥ç®¡ç†ä¸ç¬¦åˆ â€œå•ä¸€èŒè´£â€ çš„åŸåˆ™ï¼Œè®© Pod ç›´æ¥å»é€‰æ‹© PV ä¹Ÿä¸çµæ´»ã€‚æ‰€ä»¥ Kubernetes å°±åˆå¢åŠ äº†ä¸¤ä¸ªæ–°å¯¹è±¡ï¼ŒPersistentVolumeClaim å’Œ StorageClassï¼Œè¿™ç§ â€œä¸­é—´å±‚â€ çš„æ€æƒ³ï¼ŒæŠŠå­˜å‚¨å·çš„åˆ†é…ç®¡ç†è¿‡ç¨‹å†æ¬¡ç»†åŒ–ã€‚
PersistentVolumeClaimï¼Œç®€ç§° PVCï¼Œç”¨æ¥å‘ Kubernetes ç”³è¯·å­˜å‚¨èµ„æºã€‚PVC æ˜¯ç»™ Pod ä½¿ç”¨çš„å¯¹è±¡ï¼Œå®ƒç›¸å½“äºæ˜¯ Pod çš„ä»£ç†ï¼Œä»£è¡¨ Pod å‘ç³»ç»Ÿç”³è¯· PVã€‚ä¸€æ—¦èµ„æºç”³è¯·æˆåŠŸï¼ŒKubernetes å°±ä¼šæŠŠ PV å’Œ PVC å…³è”åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªåŠ¨ä½œå«åš â€œç»‘å®šâ€ï¼ˆbindï¼‰ã€‚">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="2.13 PersistentVolume" />
<meta property="og:description" content="2.13 PersistentVolume # Pod é‡Œçš„å®¹å™¨æ˜¯ç”±é•œåƒäº§ç”Ÿçš„ï¼Œè€Œé•œåƒæ–‡ä»¶æœ¬èº«æ˜¯åªè¯»çš„ï¼Œè¿›ç¨‹è¦è¯»å†™ç£ç›˜åªèƒ½ç”¨ä¸€ä¸ªä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ï¼Œä¸€æ—¦ Pod é”€æ¯ï¼Œä¸´æ—¶å­˜å‚¨ä¹Ÿå°±ä¼šç«‹å³å›æ”¶é‡Šæ”¾ï¼Œæ•°æ®ä¹Ÿå°±ä¸¢å¤±äº†ã€‚
Kubernetes çš„ Volume å¯¹æ•°æ®å­˜å‚¨å·²ç»ç»™å‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„æŠ½è±¡ï¼Œå®ƒåªæ˜¯å®šä¹‰äº†æœ‰è¿™ä¹ˆä¸€ä¸ª â€œå­˜å‚¨å·â€ï¼Œè€Œè¿™ä¸ª â€œå­˜å‚¨å·â€ æ˜¯ä»€ä¹ˆç±»å‹ã€æœ‰å¤šå¤§å®¹é‡ã€æ€ä¹ˆå­˜å‚¨ï¼Œå¯ä»¥è‡ªç”±å‘æŒ¥ã€‚Pod ä¸éœ€è¦å…³å¿ƒé‚£äº›ä¸“ä¸šã€å¤æ‚çš„ç»†èŠ‚ï¼Œåªè¦è®¾ç½®å¥½ volumeMountsï¼Œå°±å¯ä»¥æŠŠ Volume åŠ è½½è¿›å®¹å™¨é‡Œä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œç”± Volume çš„æ¦‚å¿µï¼Œå»¶ä¼¸å‡ºäº† PersistentVolume å¯¹è±¡ï¼Œå®ƒä¸“é—¨ç”¨æ¥è¡¨ç¤ºæŒä¹…å­˜å‚¨è®¾å¤‡ï¼Œä½†éšè—äº†å­˜å‚¨çš„åº•å±‚å®ç°ï¼Œä½¿ç”¨è€…åªéœ€è¦çŸ¥é“å®ƒèƒ½å®‰å…¨å¯é åœ°ä¿ç®¡æ•°æ®å°±å¯ä»¥äº†ï¼ˆç”±äº PersistentVolume è¿™ä¸ªè¯å¾ˆé•¿ï¼Œä¸€èˆ¬æŠŠå®ƒç®€ç§°ä¸º PVï¼‰ã€‚
ä½œä¸ºå­˜å‚¨çš„æŠ½è±¡ï¼ŒPV å®é™…ä¸Šå°±æ˜¯ä¸€äº›å­˜å‚¨è®¾å¤‡ã€æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ Cephã€GlusterFSã€NFSï¼Œç”šè‡³æ˜¯æœ¬åœ°ç£ç›˜ï¼Œç®¡ç†å®ƒä»¬å·²ç»è¶…å‡ºäº† Kubernetes çš„èƒ½åŠ›èŒƒå›´ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬ä¼šç”±ç³»ç»Ÿç®¡ç†å‘˜å•ç‹¬ç»´æŠ¤ï¼Œç„¶åå†åœ¨ Kubernetes é‡Œåˆ›å»ºå¯¹åº”çš„ PVã€‚PV å±äºé›†ç¾¤çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯å’Œ Node å¹³çº§çš„ä¸€ç§å¯¹è±¡ï¼ŒPod å¯¹å®ƒæ²¡æœ‰ç®¡ç†æƒï¼Œåªæœ‰ä½¿ç”¨æƒã€‚
2.13.1 PersistentVolumeClaim/StorageClass # ç”±äºä¸åŒå­˜å‚¨è®¾å¤‡çš„å·®å¼‚å®åœ¨æ˜¯å¤ªå¤§äº†ï¼šæœ‰çš„é€Ÿåº¦å¿«ï¼Œæœ‰çš„é€Ÿåº¦æ…¢ï¼›æœ‰çš„å¯ä»¥å…±äº«è¯»å†™ï¼Œæœ‰çš„åªèƒ½ç‹¬å è¯»å†™ï¼›æœ‰çš„å®¹é‡å°ï¼Œåªæœ‰å‡ ç™¾ MBï¼Œæœ‰çš„å®¹é‡å¤§åˆ° TBã€PB çº§åˆ«ç­‰ï¼Œè¿™ä¹ˆå¤šç§å­˜å‚¨è®¾å¤‡ï¼Œåªç”¨ä¸€ä¸ª PV å¯¹è±¡æ¥ç®¡ç†ä¸ç¬¦åˆ â€œå•ä¸€èŒè´£â€ çš„åŸåˆ™ï¼Œè®© Pod ç›´æ¥å»é€‰æ‹© PV ä¹Ÿä¸çµæ´»ã€‚æ‰€ä»¥ Kubernetes å°±åˆå¢åŠ äº†ä¸¤ä¸ªæ–°å¯¹è±¡ï¼ŒPersistentVolumeClaim å’Œ StorageClassï¼Œè¿™ç§ â€œä¸­é—´å±‚â€ çš„æ€æƒ³ï¼ŒæŠŠå­˜å‚¨å·çš„åˆ†é…ç®¡ç†è¿‡ç¨‹å†æ¬¡ç»†åŒ–ã€‚
PersistentVolumeClaimï¼Œç®€ç§° PVCï¼Œç”¨æ¥å‘ Kubernetes ç”³è¯·å­˜å‚¨èµ„æºã€‚PVC æ˜¯ç»™ Pod ä½¿ç”¨çš„å¯¹è±¡ï¼Œå®ƒç›¸å½“äºæ˜¯ Pod çš„ä»£ç†ï¼Œä»£è¡¨ Pod å‘ç³»ç»Ÿç”³è¯· PVã€‚ä¸€æ—¦èµ„æºç”³è¯·æˆåŠŸï¼ŒKubernetes å°±ä¼šæŠŠ PV å’Œ PVC å…³è”åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªåŠ¨ä½œå«åš â€œç»‘å®šâ€ï¼ˆbindï¼‰ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/kubernetes/docs/part2-break-ice/2.13-persistent-volume/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2023-06-13T12:50:35+08:00" />
<title>2.13 PersistentVolume | Kubernetes å­¦ä¹ ç¬”è®°</title>
<link rel="manifest" href="/kubernetes/manifest.json">
<link rel="icon" href="/kubernetes/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/kubernetes/book.min.cad59a3be22b32d901c8b99a5bf0c00f01535383d8d0e86742e5449f598d17af.css" integrity="sha256-ytWaO&#43;IrMtkByLmaW/DADwFTU4PY0OhnQuVEn1mNF68=" crossorigin="anonymous">
  <script defer src="/kubernetes/flexsearch.min.js"></script>
  <script defer src="/kubernetes/zh.search.min.6a49f949d6c64c82c1530df1a06dca2b9fc0405bdaedd9bb43bc1e183bad6c4e.js" integrity="sha256-akn5SdbGTILBUw3xoG3KK5/AQFva7dm7Q7weGDutbE4=" crossorigin="anonymous"></script>

  <script defer src="/kubernetes/sw.min.448c1a1f6d77a9e91ad10af73bc5bccfa94948c630159862e4b698042cdae427.js" integrity="sha256-RIwaH213qeka0Qr3O8W8z6lJSMYwFZhi5LaYBCza5Cc=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/kubernetes/"><span>Kubernetes å­¦ä¹ ç¬”è®°</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="æœç´¢" aria-label="æœç´¢" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>




<ul>
    <li>
        <a href="javascript:void(0)" onclick="hrefIndex()" rel="noopener">ä¸»é¡µ</a>
    </li>
    <li>
        <a href="https://github.com/xiaobinqt" target="_blank" rel="noopener">GitHub</a>
    </li>
</ul>

<hr>

<script>
    function hrefIndex() {
        window.location = window.location.origin;
    }
</script>


  
<ul>
  
  <li>
    <a href=""  target="_blank" rel="noopener">
        
      </a>
  </li>
  
</ul>







  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>ç¬¬ä¸€éƒ¨åˆ† Docker</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part1-primary/1.1-docker-brief/" class="">1.1 Docker ç®€ä»‹</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part1-primary/1.2-docker-cmd/" class="">1.2 Docker å¸¸ç”¨å‘½ä»¤</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part1-primary/1.3-container/" class="">1.3 å®¹å™¨</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part1-primary/1.4-image/" class="">1.4 é•œåƒ</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part1-primary/1.5-network/" class="">1.5 ç½‘ç»œäº’é€š</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part1-primary/1.6-docker-compose/" class="">1.6 Docker Compose</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part1-primary/1.7-private-registry/" class="">1.7 ç§æœ‰é•œåƒä»“åº“</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>ç¬¬äºŒéƒ¨åˆ† å…¥é—¨</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.1-k8s-overview/" class="">2.1 ç®€ä»‹</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.2-minikube/" class="">2.2 minikube</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.3-working-mechanism/" class="">2.3 å·¥ä½œæœºåˆ¶</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.4-pod/" class="">2.4 Pod</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.5-job/" class="">2.5 Job</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.6-config-manage/" class="">2.6 é…ç½®ç®¡ç†</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.7-general-cmd/" class="">2.7 å¸¸ç”¨å‘½ä»¤</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.8-kubeadm/" class="">2.8 kubeadm æ­å»º</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.9-deployment/" class="">2.9 Deployment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.10-daemonset/" class="">2.10 DaemonSet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.11-service/" class="">2.11 Service</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.12-ingress/" class="">2.12 Ingress</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.13-persistent-volume/" class="active">2.13 PersistentVolume</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.14-persistentvolume-nfs/" class="">2.14 ç½‘ç»œå…±äº«å­˜å‚¨</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.15-statefulset/" class="">2.15 StatefulSet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.16-rolling-update/" class="">2.16 æ»šåŠ¨æ›´æ–°</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.17-app-assurance/" class="">2.17 åº”ç”¨ä¿éšœ</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.18-cluster-management/" class="">2.18 é›†ç¾¤ç®¡ç†</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.19-system-monitor/" class="">2.19 ç³»ç»Ÿç›‘æ§</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/kubernetes/docs/part2-break-ice/2.20-network-communications/" class="">2.20 ç½‘ç»œé€šä¿¡</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/kubernetes/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>2.13 PersistentVolume</strong>

  <label for="toc-control">
    
    <img src="/kubernetes/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#213-persistentvolume">2.13 PersistentVolume</a>
      <ul>
        <li><a href="#2131-persistentvolumeclaimstorageclass">2.13.1 PersistentVolumeClaim/StorageClass</a></li>
        <li><a href="#2132-æè¿°-persistentvolume">2.13.2 æè¿° PersistentVolume</a></li>
        <li><a href="#2133-æè¿°-persistentvolumeclaim">2.13.3 æè¿° PersistentVolumeClaim</a></li>
        <li><a href="#2134-ä½¿ç”¨-persistentvolume">2.13.4 ä½¿ç”¨ PersistentVolume</a></li>
        <li><a href="#2135-pod-æŒ‚è½½-persistentvolume">2.13.5 Pod æŒ‚è½½ PersistentVolume</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="213-persistentvolume">
  2.13 PersistentVolume
  <a class="anchor" href="#213-persistentvolume">#</a>
</h1>
<p>Pod é‡Œçš„å®¹å™¨æ˜¯ç”±é•œåƒäº§ç”Ÿçš„ï¼Œè€Œé•œåƒæ–‡ä»¶æœ¬èº«æ˜¯åªè¯»çš„ï¼Œè¿›ç¨‹è¦è¯»å†™ç£ç›˜åªèƒ½ç”¨ä¸€ä¸ª<strong>ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´</strong>ï¼Œä¸€æ—¦ Pod é”€æ¯ï¼Œä¸´æ—¶å­˜å‚¨ä¹Ÿå°±ä¼šç«‹å³å›æ”¶é‡Šæ”¾ï¼Œæ•°æ®ä¹Ÿå°±ä¸¢å¤±äº†ã€‚</p>
<p>Kubernetes çš„ Volume å¯¹æ•°æ®å­˜å‚¨å·²ç»ç»™å‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„æŠ½è±¡ï¼Œå®ƒåªæ˜¯å®šä¹‰äº†æœ‰è¿™ä¹ˆä¸€ä¸ª â€œå­˜å‚¨å·â€ï¼Œè€Œè¿™ä¸ª â€œå­˜å‚¨å·â€ æ˜¯ä»€ä¹ˆç±»å‹ã€æœ‰å¤šå¤§å®¹é‡ã€æ€ä¹ˆå­˜å‚¨ï¼Œå¯ä»¥è‡ªç”±å‘æŒ¥ã€‚Pod ä¸éœ€è¦å…³å¿ƒé‚£äº›ä¸“ä¸šã€å¤æ‚çš„ç»†èŠ‚ï¼Œåªè¦è®¾ç½®å¥½ volumeMountsï¼Œå°±å¯ä»¥æŠŠ Volume åŠ è½½è¿›å®¹å™¨é‡Œä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œç”± Volume çš„æ¦‚å¿µï¼Œå»¶ä¼¸å‡ºäº† PersistentVolume å¯¹è±¡ï¼Œå®ƒä¸“é—¨ç”¨æ¥è¡¨ç¤ºæŒä¹…å­˜å‚¨è®¾å¤‡ï¼Œä½†éšè—äº†å­˜å‚¨çš„åº•å±‚å®ç°ï¼Œä½¿ç”¨è€…åªéœ€è¦çŸ¥é“å®ƒèƒ½å®‰å…¨å¯é åœ°ä¿ç®¡æ•°æ®å°±å¯ä»¥äº†ï¼ˆç”±äº PersistentVolume è¿™ä¸ªè¯å¾ˆé•¿ï¼Œä¸€èˆ¬æŠŠå®ƒç®€ç§°ä¸º PVï¼‰ã€‚</p>
<p>ä½œä¸ºå­˜å‚¨çš„æŠ½è±¡ï¼ŒPV å®é™…ä¸Šå°±æ˜¯ä¸€äº›å­˜å‚¨è®¾å¤‡ã€æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ Cephã€GlusterFSã€NFSï¼Œç”šè‡³æ˜¯æœ¬åœ°ç£ç›˜ï¼Œç®¡ç†å®ƒä»¬å·²ç»è¶…å‡ºäº† Kubernetes çš„èƒ½åŠ›èŒƒå›´ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬ä¼šç”±ç³»ç»Ÿç®¡ç†å‘˜å•ç‹¬ç»´æŠ¤ï¼Œç„¶åå†åœ¨ Kubernetes é‡Œåˆ›å»ºå¯¹åº”çš„ PVã€‚PV å±äºé›†ç¾¤çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯å’Œ Node å¹³çº§çš„ä¸€ç§å¯¹è±¡ï¼ŒPod å¯¹å®ƒæ²¡æœ‰ç®¡ç†æƒï¼Œåªæœ‰ä½¿ç”¨æƒã€‚</p>
<h2 id="2131-persistentvolumeclaimstorageclass">
  2.13.1 PersistentVolumeClaim/StorageClass
  <a class="anchor" href="#2131-persistentvolumeclaimstorageclass">#</a>
</h2>
<p>ç”±äºä¸åŒå­˜å‚¨è®¾å¤‡çš„å·®å¼‚å®åœ¨æ˜¯å¤ªå¤§äº†ï¼šæœ‰çš„é€Ÿåº¦å¿«ï¼Œæœ‰çš„é€Ÿåº¦æ…¢ï¼›æœ‰çš„å¯ä»¥å…±äº«è¯»å†™ï¼Œæœ‰çš„åªèƒ½ç‹¬å è¯»å†™ï¼›æœ‰çš„å®¹é‡å°ï¼Œåªæœ‰å‡ ç™¾ MBï¼Œæœ‰çš„å®¹é‡å¤§åˆ° TBã€PB çº§åˆ«ç­‰ï¼Œè¿™ä¹ˆå¤šç§å­˜å‚¨è®¾å¤‡ï¼Œåªç”¨ä¸€ä¸ª PV å¯¹è±¡æ¥ç®¡ç†ä¸ç¬¦åˆ â€œå•ä¸€èŒè´£â€ çš„åŸåˆ™ï¼Œè®© Pod ç›´æ¥å»é€‰æ‹© PV ä¹Ÿä¸çµæ´»ã€‚æ‰€ä»¥ Kubernetes å°±åˆå¢åŠ äº†ä¸¤ä¸ªæ–°å¯¹è±¡ï¼ŒPersistentVolumeClaim å’Œ StorageClassï¼Œè¿™ç§ â€œä¸­é—´å±‚â€ çš„æ€æƒ³ï¼ŒæŠŠå­˜å‚¨å·çš„åˆ†é…ç®¡ç†è¿‡ç¨‹å†æ¬¡ç»†åŒ–ã€‚</p>
<p>PersistentVolumeClaimï¼Œç®€ç§° PVCï¼Œç”¨æ¥å‘ Kubernetes ç”³è¯·å­˜å‚¨èµ„æºã€‚PVC æ˜¯ç»™ Pod ä½¿ç”¨çš„å¯¹è±¡ï¼Œå®ƒç›¸å½“äºæ˜¯ Pod çš„ä»£ç†ï¼Œä»£è¡¨ Pod å‘ç³»ç»Ÿç”³è¯· PVã€‚ä¸€æ—¦èµ„æºç”³è¯·æˆåŠŸï¼ŒKubernetes å°±ä¼šæŠŠ PV å’Œ PVC å…³è”åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªåŠ¨ä½œå«åš â€œç»‘å®šâ€ï¼ˆbindï¼‰ã€‚</p>
<p>ç”±äºç³»ç»Ÿé‡Œçš„å­˜å‚¨èµ„æºéå¸¸å¤šï¼Œå¦‚æœè¦ PVC å»ç›´æ¥éå†æŸ¥æ‰¾åˆé€‚çš„ PV ä¹Ÿå¾ˆéº»çƒ¦ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº† StorageClassã€‚StorageClass æŠ½è±¡äº†ç‰¹å®šç±»å‹çš„å­˜å‚¨ç³»ç»Ÿï¼ˆæ¯”å¦‚ Cephã€NFSï¼‰ï¼Œåœ¨ PVC å’Œ PV ä¹‹é—´å……å½“ â€œåè°ƒäººâ€ çš„è§’è‰²ï¼Œå¸®åŠ© PVC æ‰¾åˆ°åˆé€‚çš„ PVã€‚</p>
<div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230612/bd5729ddbb5040c8922e6d023e0f490c.png" width=700  /></div>
<h2 id="2132-æè¿°-persistentvolume">
  2.13.2 æè¿° PersistentVolume
  <a class="anchor" href="#2132-%e6%8f%8f%e8%bf%b0-persistentvolume">#</a>
</h2>
<p>Kubernetes é‡Œæœ‰å¾ˆå¤šç§ç±»å‹çš„ PVï¼Œæœ€å®¹æ˜“çš„æ˜¯æœ¬æœºå­˜å‚¨ HostPathï¼Œå®ƒå’Œ Docker é‡ŒæŒ‚è½½æœ¬åœ°ç›®å½•çš„ <code>-v</code> å‚æ•°éå¸¸ç±»ä¼¼ã€‚å› ä¸º Pod ä¼šåœ¨é›†ç¾¤çš„ä»»æ„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ‰€ä»¥ç³»ç»Ÿç®¡ç†å‘˜éœ€åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå®ƒå°†ä¼šä½œä¸ºæœ¬åœ°å­˜å‚¨å·æŒ‚è½½åˆ° Pod é‡Œã€‚</p>
<p>æ¯”å¦‚åœ¨ /tmp é‡Œå»ºä¸€ä¸ªåå­—æ˜¯ host-10m-pv çš„ç›®å½•ï¼Œè¡¨ç¤ºä¸€ä¸ªåªæœ‰ 10MB å®¹é‡çš„å­˜å‚¨è®¾å¤‡ã€‚æœ‰äº†å­˜å‚¨ï¼Œå°±å¯ä»¥ä½¿ç”¨ YAML æ¥æè¿°è¿™ä¸ª PV å¯¹è±¡äº†ã€‚è¿™é‡Œä¸èƒ½ç”¨ kubectl create ç›´æ¥åˆ›å»º PV å¯¹è±¡ï¼Œåªèƒ½ç”¨ kubectl api-resourcesã€kubectl explain æŸ¥çœ‹ PV çš„å­—æ®µè¯´æ˜ï¼Œæ‰‹åŠ¨ç¼–å†™ PV çš„ YAML æè¿°æ–‡ä»¶ğŸ˜‚ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª YAML æè¿°ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">host-10m-pv</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">host-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Mi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/tmp/host-10m-pv/</span>
</span></span></code></pre></div><p>storageClassName è¡¨ç¤ºå¯¹å­˜å‚¨ç±»å‹çš„æŠ½è±¡ StorageClassã€‚è¿™ä¸ª PV æ˜¯æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç†çš„ï¼Œåå­—å¯ä»¥ä»»æ„èµ·ï¼Œè¿™é‡Œå†™çš„æ˜¯ host-testã€‚</p>
<p>accessModes å®šä¹‰äº†å­˜å‚¨è®¾å¤‡çš„è®¿é—®æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿç›˜çš„è¯»å†™æƒé™ï¼Œå’Œ Linux çš„æ–‡ä»¶è®¿é—®æ¨¡å¼å·®ä¸å¤šï¼Œç›®å‰ Kubernetes æœ‰ 3 ç§ï¼š</p>
<ul>
<li>
<p>ReadWriteOnceï¼šå­˜å‚¨å·å¯è¯»å¯å†™ï¼Œä½†åªèƒ½è¢«ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ Pod æŒ‚è½½ã€‚</p>
</li>
<li>
<p>ReadOnlyManyï¼šå­˜å‚¨å·åªè¯»ä¸å¯å†™ï¼Œå¯ä»¥è¢«ä»»æ„èŠ‚ç‚¹ä¸Šçš„ Pod å¤šæ¬¡æŒ‚è½½ã€‚</p>
</li>
<li>
<p>ReadWriteManyï¼šå­˜å‚¨å·å¯è¯»å¯å†™ï¼Œä¹Ÿå¯ä»¥è¢«ä»»æ„èŠ‚ç‚¹ä¸Šçš„ Pod å¤šæ¬¡æŒ‚è½½ã€‚</p>
</li>
</ul>
<p>è¿™ 3 ç§è®¿é—®æ¨¡å¼<strong>é™åˆ¶çš„å¯¹è±¡æ˜¯èŠ‚ç‚¹</strong>è€Œä¸æ˜¯ Podï¼Œå› ä¸ºå­˜å‚¨æ˜¯ç³»ç»Ÿçº§åˆ«çš„æ¦‚å¿µï¼Œä¸å±äº Pod é‡Œçš„è¿›ç¨‹ã€‚å› ä¸ºæœ¬åœ°ç›®å½•åªèƒ½æ˜¯åœ¨æœ¬æœºä½¿ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ª PV ä½¿ç”¨äº† ReadWriteOnce è®¿é—®æ¨¡å¼ã€‚</p>
<p>capacity è¡¨ç¤ºå­˜å‚¨è®¾å¤‡çš„å®¹é‡ï¼Œè¿™é‡Œè®¾ç½®ä¸º 10MBã€‚</p>
<p>Kubernetes é‡Œå®šä¹‰å­˜å‚¨å®¹é‡ä½¿ç”¨çš„æ˜¯<strong>å›½é™…æ ‡å‡†</strong>ï¼Œæ—¥å¸¸ä¹ æƒ¯ä½¿ç”¨çš„ KB/MB/GB çš„åŸºæ•°æ˜¯ 1024ï¼Œè¦å†™æˆ Ki/Mi/Giï¼Œå¦‚æœå†™é”™äº†ï¼Œå•ä½ä¸ä¸€è‡´å®é™…å®¹é‡å°±ä¼šå¯¹ä¸ä¸Šã€‚</p>
<p>hostPath æŒ‡å®šäº†å­˜å‚¨å·çš„æœ¬åœ°è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºçš„ç›®å½•ã€‚</p>
<h2 id="2133-æè¿°-persistentvolumeclaim">
  2.13.3 æè¿° PersistentVolumeClaim
  <a class="anchor" href="#2133-%e6%8f%8f%e8%bf%b0-persistentvolumeclaim">#</a>
</h2>
<p>æœ‰äº† PV å°±è¡¨ç¤ºé›†ç¾¤é‡Œæœ‰äº†ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨å¯ä»¥ä¾› Pod ä½¿ç”¨ï¼Œéœ€è¦å†å®šä¹‰ PVC å¯¹è±¡ï¼Œå‘ Kubernetes ç”³è¯·å­˜å‚¨ã€‚ä¸‹é¢è¿™ä¸ª YAML PVC æè¿°ï¼Œè¦æ±‚ä½¿ç”¨ä¸€ä¸ª 5MB çš„å­˜å‚¨è®¾å¤‡ï¼Œè®¿é—®æ¨¡å¼æ˜¯ ReadWriteOnceï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">host-5m-pvc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">host-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Mi</span>
</span></span></code></pre></div><p>PVC çš„ YAML å†…å®¹ä¸ PV å¾ˆåƒï¼Œä½†å®ƒä¸è¡¨ç¤ºå®é™…çš„å­˜å‚¨ï¼Œè€Œæ˜¯ä¸€ä¸ª â€œç”³è¯·â€ æˆ–è€… â€œå£°æ˜â€ï¼Œspec é‡Œçš„å­—æ®µæè¿°çš„æ˜¯å¯¹å­˜å‚¨çš„ â€œæœŸæœ›çŠ¶æ€â€ã€‚PVC é‡Œçš„ storageClassNameã€accessModes å’Œ PV æ˜¯ä¸€æ ·çš„ï¼Œä½†<strong>ä¸ä¼š</strong>æœ‰å­—æ®µ capacityï¼Œè€Œæ˜¯è¦ç”¨ resources.request è¡¨ç¤ºå¸Œæœ›è¦æœ‰å¤šå¤§çš„å®¹é‡ã€‚</p>
<p>Kubernetes ä¼šæ ¹æ® PVC é‡Œçš„æè¿°ï¼Œå»æ‰¾èƒ½å¤ŸåŒ¹é… StorageClass å’Œå®¹é‡çš„ PVï¼Œç„¶åæŠŠ PV å’Œ PVC â€œç»‘å®šâ€ åœ¨ä¸€èµ·ï¼Œå®ç°å­˜å‚¨çš„åˆ†é…ã€‚</p>
<h2 id="2134-ä½¿ç”¨-persistentvolume">
  2.13.4 ä½¿ç”¨ PersistentVolume
  <a class="anchor" href="#2134-%e4%bd%bf%e7%94%a8-persistentvolume">#</a>
</h2>
<p>å½“å·²ç»å‡†å¤‡å¥½äº† PV å’Œ PVCï¼Œå°±å¯ä»¥è®© Pod å®ç°æŒä¹…åŒ–å­˜å‚¨äº†ã€‚</p>
<p>host-path-pv.yml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">host-10m-pv</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">host-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Mi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/tmp/host-10m-pv/</span>
</span></span></code></pre></div><p>host-path-pvc.yml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">host-5m-pvc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">host-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">5Mi</span>
</span></span></code></pre></div><div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230613/dc738d5f31664f0ea8f46b306abc5b8d.png" width=  /></div>
<p>ä»ä¸Šé¢çš„æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª PV çš„å®¹é‡æ˜¯ 10MBï¼Œè®¿é—®æ¨¡å¼æ˜¯ RWOï¼ˆReadWriteOnceï¼‰ï¼ŒStorageClass æ˜¯æˆ‘ä»¬å®šä¹‰çš„ host-testï¼ŒçŠ¶æ€æ˜¾ç¤ºçš„æ˜¯ Availableï¼Œä¹Ÿå°±æ˜¯å¤„äºå¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥éšæ—¶åˆ†é…ç»™ Pod ä½¿ç”¨ã€‚</p>
<div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230613/ca3db52ab5bf4fa9900bf9457c28b66d.png" width=  /></div>
<p>ä¸€æ—¦ PVC å¯¹è±¡åˆ›å»ºæˆåŠŸï¼ŒKubernetes å°±ä¼šç«‹å³é€šè¿‡ StorageClassã€resources ç­‰æ¡ä»¶åœ¨é›†ç¾¤é‡ŒæŸ¥æ‰¾ç¬¦åˆè¦æ±‚çš„ PVï¼Œå¦‚æœæ‰¾åˆ°åˆé€‚çš„å­˜å‚¨å¯¹è±¡å°±ä¼šæŠŠå®ƒä¿© â€œç»‘å®šâ€ åœ¨ä¸€èµ·ã€‚</p>
<p>PVC å¯¹è±¡ç”³è¯·çš„æ˜¯ 5MBï¼Œä½†ç°åœ¨ç³»ç»Ÿé‡Œåªæœ‰ä¸€ä¸ª 10MB çš„ PVï¼Œæ²¡æœ‰æ›´åˆé€‚çš„å¯¹è±¡ï¼Œæ‰€ä»¥ Kubernetes ä¹Ÿåªèƒ½æŠŠè¿™ä¸ª PV åˆ†é…å‡ºå»ï¼Œå¤šå‡ºçš„å®¹é‡å°±ç®—æ˜¯ â€œç¦åˆ©â€ äº†ã€‚è¿™ä¸¤ä¸ªå¯¹è±¡çš„çŠ¶æ€éƒ½æ˜¯ Boundï¼Œä¹Ÿå°±æ˜¯è¯´å­˜å‚¨ç”³è¯·æˆåŠŸï¼ŒPVC çš„å®é™…å®¹é‡å°±æ˜¯ PV çš„å®¹é‡ 10MBï¼Œè€Œä¸æ˜¯æœ€åˆç”³è¯·çš„å®¹é‡ 5MBã€‚</p>
<p>å¦‚æœæŠŠ PVC çš„ç”³è¯·å®¹é‡æ”¹å¤§ä¸€äº›ï¼Œæ¯”å¦‚æ”¹æˆ 100MBï¼Œapply åä¼šçœ‹åˆ° PVC ä¼šä¸€ç›´å¤„äº Pending çŠ¶æ€ï¼Œæ„å‘³ç€ Kubernetes åœ¨ç³»ç»Ÿé‡Œæ²¡æœ‰æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„å­˜å‚¨ï¼Œæ— æ³•åˆ†é…èµ„æºï¼Œåªèƒ½ç­‰æœ‰æ»¡è¶³è¦æ±‚çš„ PV æ‰èƒ½å®Œæˆç»‘å®šã€‚</p>
<h2 id="2135-pod-æŒ‚è½½-persistentvolume">
  2.13.5 Pod æŒ‚è½½ PersistentVolume
  <a class="anchor" href="#2135-pod-%e6%8c%82%e8%bd%bd-persistentvolume">#</a>
</h2>
<p>å½“ PV å’Œ PVC ç»‘å®šå¥½äº†ï¼Œæœ‰äº†æŒä¹…åŒ–å­˜å‚¨ï¼Œå°±å¯ä»¥ä¸º Pod æŒ‚è½½å­˜å‚¨å·ã€‚å…ˆè¦åœ¨ spec.volumes å®šä¹‰å­˜å‚¨å·ï¼Œç„¶ååœ¨ containers.volumeMounts æŒ‚è½½è¿›å®¹å™¨ã€‚å› ä¸ºç”¨çš„æ˜¯ PVCï¼Œæ‰€ä»¥è¦åœ¨ volumes é‡Œç”¨å­—æ®µ persistentVolumeClaim æŒ‡å®š PVC çš„åå­—ã€‚</p>
<p>ä»¥ä¸‹çš„ Pod çš„ YAML æè¿°æ–‡ä»¶ï¼ŒæŠŠå­˜å‚¨å·æŒ‚è½½åˆ°äº† Nginx å®¹å™¨çš„ /tmp ç›®å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">host-pvc-pod</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">host-pvc-vol</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">host-5m-pvc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ngx-pvc-pod</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:alpine</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">host-pvc-vol</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/tmp</span>
</span></span></code></pre></div><div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230613/cc9fb0caba124893bf9658413f21e959.png" width=  /></div>
<p>åˆ›å»º Pod å¹¶æŸ¥çœ‹å®ƒçš„çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl apply -f host-path-pod.yml
</span></span><span style="display:flex;"><span>kubectl get pod -o wide
</span></span></code></pre></div><div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230613/9a42b9f9e07e47e6bd8813021ee0441f.png" width=  /></div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª Pod è¢« Kubernetes è°ƒåˆ°äº† worker èŠ‚ç‚¹ä¸Šã€‚å¯ä»¥ä½¿ç”¨ kubectl exec è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹ PV æ˜¯å¦ç¡®å®æŒ‚è½½æˆåŠŸï¼š</p>
<div align="center"><img src="https://cdn.xiaobinqt.cn/xiaobinqt.io/20230613/fe74f66ace974d61ac62f2d974d2eafe.png" width=  /></div>
<p>åœ¨å®¹å™¨çš„ /tmp ç›®å½•é‡Œç”Ÿæˆäº†ä¸€ä¸ª a.txt çš„æ–‡ä»¶ï¼Œæ ¹æ® PV çš„å®šä¹‰ï¼Œè¿™ä¸ªæ–‡ä»¶å°±åº”è¯¥è½åœ¨ worker èŠ‚ç‚¹çš„ç£ç›˜ä¸Šï¼Œç™»å½•åˆ° worker èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹ï¼Œåœ¨ worker èŠ‚ç‚¹è¿™å°æœºå™¨çš„ /tmp/host-10m-pv ç›®å½•ä¸‹ï¼Œé‡Œé¢æœ‰ä¸ª a.txt æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹è·Ÿæˆ‘ä»¬åœ¨å®¹å™¨ä¸­åˆ›å»ºçš„ä¸€æ ·ï¼Œå¯ä»¥ç¡®è®¤ç¡®å®æ˜¯åˆšæ‰åœ¨ Pod é‡Œç”Ÿæˆçš„æ–‡ä»¶ã€‚å…¶å®<strong>å¹¶æ²¡æœ‰æå‰</strong>åœ¨ worker èŠ‚ç‚¹ä¸Šåˆ›å»º /tmp/host-10m-pv ç›®å½•ï¼Œä½†æ˜¯å½“ Pod è¿è¡Œèµ·æ¥æ—¶ï¼Œ/tmp/host-10m-pv ç›®å½•åœ¨ worker èŠ‚ç‚¹ä¸Šè¢«è‡ªåŠ¨åˆ›å»ºäº†ã€‚</p>
<p>å› ä¸º Pod äº§ç”Ÿçš„æ•°æ®å·²ç»é€šè¿‡ PV å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå¦‚æœ Pod åˆ é™¤åå†é‡æ–°åˆ›å»ºï¼ŒæŒ‚è½½å­˜å‚¨å·æ—¶ä¼šä¾ç„¶ä½¿ç”¨è¿™ä¸ªç›®å½•ï¼Œæ•°æ®ä¿æŒä¸å˜ï¼Œä¹Ÿå°±å®ç°äº†æŒä¹…åŒ–å­˜å‚¨ã€‚ä½†æ˜¯ï¼Œç”±äºè¿™ä¸ª PV æ˜¯ HostPath ç±»å‹ï¼Œåªåœ¨æœ¬èŠ‚ç‚¹å­˜å‚¨ï¼Œå¦‚æœ Pod é‡å»ºæ—¶è¢«è°ƒåº¦åˆ°äº†å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå³ä½¿åŠ è½½äº†æœ¬åœ°ç›®å½•ï¼Œä¹Ÿä¸ä¼šæ˜¯ä¹‹å‰çš„å­˜å‚¨ä½ç½®ï¼ŒæŒä¹…åŒ–åŠŸèƒ½ä¹Ÿå°±å¤±æ•ˆäº†ã€‚</p>
<p>æ‰€ä»¥ï¼ŒHostPath ç±»å‹çš„ PV ä¸€èˆ¬ç”¨æ¥åšæµ‹è¯•ï¼Œæˆ–è€…æ˜¯ç”¨äº DaemonSet è¿™æ ·ä¸èŠ‚ç‚¹å…³ç³»æ¯”è¾ƒå¯†åˆ‡çš„åº”ç”¨ã€‚</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/xiaobinqt/xiaobinqt.github.io/commit/8ae3d01356cb2a4e6abbe7cfb9173a00e70b8d56" title='æœ€åä¿®æ”¹è€… weibin | June 13, 2023' target="_blank" rel="noopener">
      <img src="/kubernetes/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>June 13, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/xiaobinqt/xiaobinqt.github.io/tree/main/content/docs/part2-break-ice/2.13-persistent-volume.md" target="_blank" rel="noopener">
      <img src="/kubernetes/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>ç¼–è¾‘æœ¬é¡µ</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#213-persistentvolume">2.13 PersistentVolume</a>
      <ul>
        <li><a href="#2131-persistentvolumeclaimstorageclass">2.13.1 PersistentVolumeClaim/StorageClass</a></li>
        <li><a href="#2132-æè¿°-persistentvolume">2.13.2 æè¿° PersistentVolume</a></li>
        <li><a href="#2133-æè¿°-persistentvolumeclaim">2.13.3 æè¿° PersistentVolumeClaim</a></li>
        <li><a href="#2134-ä½¿ç”¨-persistentvolume">2.13.4 ä½¿ç”¨ PersistentVolume</a></li>
        <li><a href="#2135-pod-æŒ‚è½½-persistentvolume">2.13.5 Pod æŒ‚è½½ PersistentVolume</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












